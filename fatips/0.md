| FATIP | Title                   | Status | Category       | Author                             | Created   |
| ----- | ----------------------- | ------ | -------------- | ---------------------------------- | --------- |
| 0     | Fungible Token Standard | Draft  | Token Standard | Devon Katz \<<devonk@dbgrow.com>\> | 7-23-2018 |



# Summary

This document describes the functionality, data structures, and validation
rules of the **FAT-0** token standard. FAT-0 is a fungible token standard. Its
functionality is most alike to the ERC-20 token standard of Ethereum.


# Motivation

Fungible tokens are ubiquitous in the cryptocurrency space. The properties of
fungible tokens are generally what most people expect from a currency: units of
the token are interchangeable and indistinguishable. Most currencies and assets
have this property, thus it follows that the first basic FAT token type should
be a simple fungible token.


# Specification

## Token Chain

A single Factom chain is used to hold the initialization of the token and all
subsequent transaction. The Factom Blockchain provides the underlying consensus
mechanism for the content and ordering of transactions. Clients shall apply
transactions in the order that they appear in the Factom Token Chain.

### Token Chain ID `inherits` [FATIP-100](100.md)

The Token Chain ID is calculated by using the Token ID and the Issuer's
Identity Chain ID as described in [FATIP-100](100.md).

As the purpose of the first entry in the Token Chain is solely intended to
create a chain with the appropriate Name IDs, the content of the first entry in
a Token Chain is ignored.

## Token Chain Entries

Factom Chains are permissionless, meaning that anyone can pay to submit any
entry on any chain. Thus implementations must parse all entries and determine
their validity.

### Global Requirements

All valid entries must adhere to the following.

#### On Token Chain

Only entries submitted on the Token Chain may be valid. Thus all entries must
be properly submitted and paid for according to Factom's rules.

#### Strict JSON Parsing

In order to ensure consistency across implementations, all JSON must be parsed
very strictly. In addition to the JSON structure being well-formed with all
required fields present, the following are strictly prohibited:

- unknown fields
- fields with unexpected types
- duplicate field names

Note that duplicate field names are not strictly prohibited by the JSON
specification and parsing may differ by implementation. See Implementation
Notes for some mechanisms to detect and prohibit duplicate field names.


#### External IDs and Signatures `inherits` [FATIP-103](103.md)

All valid entries must have External IDs with valid signatures that conform to
the specifications defined by [FATIP-103](103.md). The required set of
signatures depends on the entry and is defined below for each entry type.

## Token Initialization Entry

The Token Initialization Entry establishes parameters and metadata about the
Token. All entries prior to the first valid Initialization Entry shall be
ignored. A Token may only be initialized once and these parameters and metadata
cannot ever be modified. Subsequent Initializations entries after the first
valid one, are always considered invalid and ignored.

### Initialization Entry Content Example

```json
{
  "type": "FAT-0",
  "supply": 10000000,
  "symbol": "EXT",
  "metadata": {"custom-field": "example"}
}
```

### Initialization Entry Field Summary & Validation

| Name     | Type   | Description                                                   | Validation                                                                           | Required |
| -------- | ------ | ------------------------------------------------------------- | ------------------------------------------------------------------------------------ | -------- |
| type     | string | The type of this token issuance                               | Must equal 'FAT-0'                                                                   | Y        |
| supply   | number | The maximum possible number of tokens that can ever be issued | Must be greater than 0, or -1 for an unlimited supply. All other values are invalid. | Y        |
| symbol   | string | The display symbol of the token                               | Must be A-Z, and 1-4 characters in length                                            | N        |
| metadata | any    | Optional metadata defined by the Issuer                       | This may be any valid JSON type.                                                     | N        |

### Signing

The Initialization Entry must be signed by the Issuer's key established by the
Identity Chain referenced in the Token Chain's Name IDs. Thus the Identity
Chain must exist and be properly set up with a key at the time that the
Initialization Entry is submitted. See [FATIP-101](101.md) for details on key
selection from the Identity Chain and [FATIP-103](103.md) for details on
signing and External IDs.

## Token Transaction Entry `extends` [FATIP-101](101.md)

Token Transaction Entries represent the signed transfer of an amount of FAT-0
tokens from one Factoid address to another. Anyone who wishes to make a
transaction must create a well-formed entry with a valid signature on the
token's chain.

The order of transactions is solely determined by the order the transaction
entries appear in the token chain. Factom provides a locked, time ordered
record of submission for each transaction. The presense of a Transaction Entry
in the chain is necessary but not sufficient for the transaction to be
considered valid. Sufficient balance, valid signatures, as well as some other
requirements to prevent replay attacks are described below.

FAT-0 transactions borrow cryptographic elements from Factoid Transactions,
including it's RCD (Redeem Condition Datastructure) address format, and
signatures. FAT-0 transactions are multi-input, multi-output (MIMO).

For standard transactions, RCDs and corresponding signatures are provided in
the External IDs of the Transaction Entry. For coinbase transactions that
initially distribute tokens, the signatures are provided in the structure of
the entry as described by FATIP-101.

### Transaction ID

The unique ID of a transaction is its entry hash in the Factom blockchain. This
is a unique hash of all of the data in the content and the External IDs of the
entry.


### Transaction Entry Content Example

```json
{
   "inputs:":{
      "FA1zT4aFpEvcnPqPCigB3fvGu4Q4mTXY22iiuV69DqE1pNhdF2MC": 100,
      "FA2y6VYYPR9Y9Vyy1ZuZqWWRXGXLeuvsLWGkDxq3Ed7yc11dbBKV": 50
   },
   "outputs:":{
      "FA3aECpw3gEZ7CMQvRNxEtKBGKAos3922oqYLcHQ9NqXHudC6YBM": 150
   },
   "salt":"80d87a8bd5cf2a3eca9037c2229f3701eed29360caa975531ef5fe476b1b70b5"
}
```


### Transaction Entry JSON Field Summary & Validation

| Name      | Type   | Description                           | Validation                                                   | Required |
| --------- | ------ | ------------------------------------- | ------------------------------------------------------------ | -------- |
| `inputs`  | object | The inputs of this this transaction   | Mapping of Public Factoid Address => Input amount. Amount must be a positive nonzero integer (units of of 1^-10 of a token). Must contain at least 1 key-value pair. No duplicate keys. | Y        |
| `outputs` | object | The outputs of this transaction       | Mapping of Public Factoid Address => Input amount. Amount must be a positive nonzero integer (units of of 1^-10 of a token). Must contain at least 1 key-value pair. No duplicate keys. | Y        |
| `salt`    | string | Random string to salt the transaction |                                             | N        |

### Addresses

FAT-0 uses Factom's [Factoid
Address](https://github.com/FactomProject/FactomDocs/blob/master/factomDataStructureDetails.md#human-readable-addresses)
RCD key pairs based on ed25519 cryptography to send and receive tokens.

### Reserved Coinbase & Burn Address

The public Factoid Address
`FA1zT4aFpEvcnPqPCigB3fvGu4Q4mTXY22iiuV69DqE1pNhdF2MC`, corresponding to the
Factoid private key with all zeros
(`Fs1KWJrpLdfucvmYwN2nWrwepLn8ercpMbzXshd1g8zyhKXLVLWj`) is a reserved address
for two purposes: issuing and burning tokens.

#### Issuance

Only valid Coinbase Transactions signed by the Issuer may use the Coinbase
address and an *input*. Coinbase Transactions effectively issue and distribute
new tokens to other addresses. To clarify, tokens sent from this address are
*not* previously burned tokens, but new tokens adding to the circulating
supply. Coinbase Transactions that increase the total supply (circulating and
burned) beyond the maximum supply declared in the Initialization Entry of the
token are always invalid.

#### Burning

Any tokens sent *to* the Coinbase address are forever burned and irrecoverable,
even by the Issuer of the token.


## Transaction Validation and State

There are two types of transactions which have slightly different validation
requirements: Normal transactions between Factoid Addresses, and Coinbase
transactions that mint tokens. Coinbase transactions require an additional
signature of the entry content by the issuer, stored in the transaction's
ExtIds.

A Coinbase transaction is identified by whether it has an input from the
Coinbase address: `FA1zT4aFpEvcnPqPCigB3fvGu4Q4mTXY22iiuV69DqE1pNhdF2MC`

### Computing the current state

Implementations must maintain the state of the balances of all addresses in
order to evaluate the validity of a transaction. The current state can be built
by iterating through all entries in the token chain and sequentially, updating
the state for any transaction that meets all of the necessary Transaction
Validation Requirements.

The following pseudo code describes how to compute the current state of all
balances. A transaction must be applied entirely or not at all. Entries that
are not valid transactions are simply ignored. Transactions must be evaluated
in the order that they appear in the token chain.

```
for entry in transaction_chain.entries:
    if entry.is_valid_transaction():
        if !entry.is_coinbase_transaction():
            for input in entry.inputs:
                balances[input.address] -= input.amount
        for output in entry.outputs:
            balances[output.address] += output.amount
```


### Transaction Validation Requirements

All Transactions must meet all of the T.x requirements.

Normal Transactions must additionally meet all of the N.x requirements.

Coinbase Transactions must additionally meet all of the C.x requirements.

In general, requirements are ordered by the computational and programmatic ease
of checking.

The x.1.x requirements are generally data structure validations.

The x.2.x requirements are generally parsing and other content validations.

The x.3.x requirements are generally related to cryptographic validations.

#### T.x Requirements for all transactions

- T.1.1: The content of the entry must be a single well-formed JSON.
- T.1.2: The JSON must contain all required transaction fields listed in the
  above table. The fields must comply with all stated validation criteria. No
unspecified fields may be present.
- T.1.3: The entry MUST contain exactly `2n` External IDs, where `n` is the
  number of keys in the `inputs` object. This is required to prevent replay
attacks.
- T.1.4: A Factoid Address may only appear ONCE in the `inputs` and `outputs`
  objects combined. This means that the "inputs" and "outputs" may not share
any common keys (Factoid Addresses), nor each have any duplicates.
- T.2.1: The sum of all values(amounts) in the `inputs` object must be equal to
  the sum of all values(amounts) in the `outputs` object.
- T.2.2: The entry hash of the transaction entry must be unique among all
  transactions belonging to this token.
- T.3.1: If `i` is odd then the `i`th External ID must be the raw data of a
  valid signature verified against the public key stored in the last 32 bytes
of the RCD in the `i-1`th External ID. The signed message shall be the
following three things concatenated in order:
    1. The shortest (no leading "0") decimal string representation of int(i/2)
    2. The raw bytes of the chain id
    3. The raw bytes of the content of the entry

The first prevents replay attacks from reordering External IDs, and the second
prevents replay attacks across FAT token chains.

#### N.x Requirements for normal account-to-account transactions

Normal transactions must meet all T.x and N.x requirements.

All references to External ID indexes use `0`-based indexing.

- N.2.1: The Coinbase address
  (`FA1zT4aFpEvcnPqPCigB3fvGu4Q4mTXY22iiuV69DqE1pNhdF2MC`) may not exist as a
key in `inputs`.
- N.2.2: The Factoid Addresses (keys) in `inputs` must all have balances
  greater than or equal to their respective input amounts.
- N.3.1: For each input address, there exists an External ID with even index
  which is the raw data of an RCD which hashes to the raw data payload of the
human readable Factoid Address input.

#### C.x Requirements for Coinbase distribution transactions

Coinbase transactions must meet all T.x and C.x requirements.

- C.1.1: The `inputs` object may contain only the public coinbase address as a
  key (`FA1zT4aFpEvcnPqPCigB3fvGu4Q4mTXY22iiuV69DqE1pNhdF2MC`)
- C.2.1: The coinbase input amount plus the sum of tokens issued in all
  previous Coinbase transactions must be less than or equal to `supply` from
the Issuance entry (if not unlimited).
- C.3.1: The RCD in the first External ID must hash to the PK1 key of the Token
  Issuer's Identity Chain.


# Implementation

No implementation notes at this time.




# Copyright

Copyright and related rights waived via
[CC0](https://creativecommons.org/publicdomain/zero/1.0/).
